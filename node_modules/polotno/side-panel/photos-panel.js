"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.PhotosPanel=void 0;const react_1=__importDefault(require("react")),core_1=require("@blueprintjs/core"),images_grid_1=require("./images-grid"),image_1=require("../utils/image"),use_api_1=require("../utils/use-api"),l10n_1=require("../utils/l10n"),api_1=require("../utils/api"),PhotosPanel=({store:e})=>{const{setQuery:t,loadMore:a,isReachingEnd:r,data:l,isLoading:s}=(0,use_api_1.useInfiniteAPI)({defaultQuery:"canvas",getAPI:({page:e,query:t})=>(0,api_1.unsplashList)({page:e,query:t})});return react_1.default.createElement("div",{style:{height:"100%",display:"flex",flexDirection:"column"}},react_1.default.createElement(core_1.InputGroup,{leftIcon:"search",placeholder:(0,l10n_1.t)("sidePanel.searchPlaceholder"),onChange:e=>{t(e.target.value)},style:{marginBottom:"20px"}}),react_1.default.createElement("p",{style:{textAlign:"center"}},"Photos by"," ",react_1.default.createElement("a",{href:"https://unsplash.com/",target:"_blank"},"Unsplash")),react_1.default.createElement(images_grid_1.ImagesGrid,{images:null==l?void 0:l.map((e=>e.results)).flat(),getPreview:e=>e.urls.small,onSelect:async(t,a,r)=>{var l;if(fetch((0,api_1.unsplashDownload)(t.id)),r&&"svg"===r.type)return void r.set({maskSrc:t.urls.regular});const{width:s,height:i}=await(0,image_1.getImageSize)(t.urls.small),u=((null==a?void 0:a.x)||e.width/2)-s/2,n=((null==a?void 0:a.y)||e.height/2)-i/2;null===(l=e.activePage)||void 0===l||l.addElement({type:"image",src:t.urls.regular,width:s,height:i,x:u,y:n})},isLoading:s,loadMore:!r&&a,getCredit:e=>react_1.default.createElement("span",null,"Photo by"," ",react_1.default.createElement("a",{href:`https://unsplash.com/@${e.user.username}?utm_source=polotno&utm_medium=referral`,target:"_blank"},e.user.name)," ","on"," ",react_1.default.createElement("a",{href:"https://unsplash.com/?utm_source=polotno&utm_medium=referral",target:"_blank"},"Unsplash"))}))};exports.PhotosPanel=PhotosPanel;
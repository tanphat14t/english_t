"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.RemoveBackgroundButton=exports.RemoveBackgroundDialog=exports.setRemoveBackgroundFunc=void 0;const react_1=__importDefault(require("react")),mobx_react_lite_1=require("mobx-react-lite"),core_1=require("@blueprintjs/core"),api_1=require("../utils/api"),l10n_1=require("../utils/l10n");let removeBackgroundFunc=async e=>{const t=await fetch((0,api_1.removeBackground)(),{method:"POST",body:JSON.stringify({url:e})});if(200!==t.status)return e;return(await t.json()).url};function setRemoveBackgroundFunc(e){removeBackgroundFunc=e}exports.setRemoveBackgroundFunc=setRemoveBackgroundFunc,exports.RemoveBackgroundDialog=(0,mobx_react_lite_1.observer)((({isOpen:e,onClose:t,element:r})=>{const[o,a]=react_1.default.useState(r.src);react_1.default.useEffect((()=>{a(r.src)}),[r.src]);const[c,n]=react_1.default.useState(!1),l=o!==r.src;return react_1.default.createElement(core_1.Dialog,{onClose:t,title:"Remove background from image",isOpen:e,style:{width:"80%",maxWidth:"700px"}},react_1.default.createElement("div",{className:core_1.Classes.DIALOG_BODY},react_1.default.createElement("img",{src:o,style:{width:"100%",maxHeight:"400px",objectFit:"contain"}})),react_1.default.createElement("div",{className:core_1.Classes.DIALOG_FOOTER,style:{position:"relative"}},react_1.default.createElement("a",{href:"https://photoroom.com/api",title:"Remove backgrounds with the PhotoRoom app",style:{background:"rgba(255, 255, 255, 0.8)",borderRadius:"10px",display:"inline-block",position:"absolute",top:"50%",transform:"translateY(-50%)"},target:"_blank"},react_1.default.createElement("img",{src:"https://api.polotno.dev/assets/removed-by-photoroom.svg",width:"120"})),react_1.default.createElement("div",{className:core_1.Classes.DIALOG_FOOTER_ACTIONS},!l&&react_1.default.createElement(core_1.Button,{onClick:async()=>{n(!0);try{a(await removeBackgroundFunc(r.src))}catch(e){console.error(e)}n(!1)},loading:c},(0,l10n_1.t)("toolbar.removeBackground")),l&&react_1.default.createElement(react_1.default.Fragment,null,react_1.default.createElement(core_1.Button,{onClick:()=>{a(r.src),t()},loading:c},(0,l10n_1.t)("toolbar.cancelRemoveBackground")),react_1.default.createElement(core_1.Button,{onClick:()=>{r.set({src:o}),t()},loading:c,intent:"primary"},(0,l10n_1.t)("toolbar.confirmRemoveBackground"))))))}));const RemoveBackgroundButton=({element:e})=>{const[t,r]=react_1.default.useState(!1);return react_1.default.createElement(react_1.default.Fragment,null,react_1.default.createElement(core_1.Button,{text:(0,l10n_1.t)("toolbar.removeBackground"),minimal:!0,onClick:e=>{r(!0)}}),react_1.default.createElement(exports.RemoveBackgroundDialog,{isOpen:t,onClose:()=>{r(!1)},element:e}))};exports.RemoveBackgroundButton=RemoveBackgroundButton;